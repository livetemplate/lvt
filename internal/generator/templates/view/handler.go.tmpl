package [[.PackageName]]

import (
	"log"
	"net/http"
	"time"

	"github.com/livetemplate/livetemplate"
)

// [[.ViewName]]Controller is a singleton that holds dependencies
type [[.ViewName]]Controller struct {
	// Add your dependencies here (DB, Logger, etc.)
}

// [[.ViewName]]State is pure data, cloned per session
type [[.ViewName]]State struct {
	Title       string `json:"title"`
	LastUpdated string `json:"last_updated"`
	// Add your state fields here
}

// Add your action methods here. Example:
// func (c *[[.ViewName]]Controller) MyAction(state [[.ViewName]]State, ctx *livetemplate.Context) ([[.ViewName]]State, error) {
//     // Handle action
//     state.LastUpdated = formatTime()
//     return state, nil
// }

func formatTime() string {
	return time.Now().Format("2006-01-02 15:04:05")
}

// Handler creates an http.Handler for this view
func Handler() http.Handler {
	// Controller is a singleton that holds dependencies
	controller := &[[.ViewName]]Controller{}

	// Initial state is pure data, cloned per session
	initialState := &[[.ViewName]]State{
		Title:       "[[.ViewName]]",
		LastUpdated: formatTime(),
	}

	baseTmpl := livetemplate.New("[[.ViewNameLower]]", livetemplate.WithDevMode([[.DevMode]]))
	return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
		tmpl, err := baseTmpl.Clone()
		if err != nil {
			log.Printf("Failed to clone template: %v", err)
			http.Error(w, "Internal server error", http.StatusInternalServerError)
			return
		}
		tmpl.Handle(controller, livetemplate.AsState(initialState)).ServeHTTP(w, r)
	})
}
