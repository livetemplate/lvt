package email

import (
	"log"
)

// EmailSender defines the interface for sending emails.
// Implementations can use any email service (SMTP, Mailgun, SendGrid, etc.)
type EmailSender interface {
	Send(to, subject, body string) error
}

// ConsoleEmailSender logs emails to stdout for development.
// ‚ö†Ô∏è WARNING: This sender logs magic links and reset tokens to stdout!
// Only use in development. For production, use a real email sender.
type ConsoleEmailSender struct{}

// NewConsoleEmailSender creates a new console email sender.
// ‚ö†Ô∏è SECURITY: This logs sensitive tokens. Use only for local development!
func NewConsoleEmailSender() *ConsoleEmailSender {
	return &ConsoleEmailSender{}
}

// Send logs the email to stdout instead of actually sending it.
// ‚ö†Ô∏è WARNING: This logs the full email body including magic links and tokens.
func (s *ConsoleEmailSender) Send(to, subject, body string) error {
	log.Printf("üìß EMAIL (Console Mode - DEVELOPMENT ONLY)\n")
	log.Printf("To: %s\n", to)
	log.Printf("Subject: %s\n", subject)
	log.Printf("Body:\n%s\n", body)
	log.Printf("---\n")
	return nil
}

// NoOpEmailSender discards all emails silently.
// Use this as a placeholder when email is not configured.
type NoOpEmailSender struct{}

// NewNoOpEmailSender creates a new no-op email sender.
func NewNoOpEmailSender() *NoOpEmailSender {
	return &NoOpEmailSender{}
}

// Send discards the email without logging or sending.
func (s *NoOpEmailSender) Send(to, subject, body string) error {
	// Silently discard - no logging of sensitive data
	return nil
}

// Example SMTP sender implementation (commented out):
//
// import "net/smtp"
//
// type SMTPEmailSender struct {
//     Host     string
//     Port     int
//     Username string
//     Password string
//     From     string
// }
//
// func (s *SMTPEmailSender) Send(to, subject, body string) error {
//     auth := smtp.PlainAuth("", s.Username, s.Password, s.Host)
//     msg := fmt.Sprintf("From: %s\r\nTo: %s\r\nSubject: %s\r\n\r\n%s",
//         s.From, to, subject, body)
//     addr := fmt.Sprintf("%s:%d", s.Host, s.Port)
//     return smtp.SendMail(addr, auth, s.From, []string{to}, []byte(msg))
// }

// Example Mailgun sender (commented out):
//
// import "github.com/mailgun/mailgun-go/v4"
//
// type MailgunEmailSender struct {
//     Domain string
//     APIKey string
//     From   string
// }
//
// func (s *MailgunEmailSender) Send(to, subject, body string) error {
//     mg := mailgun.NewMailgun(s.Domain, s.APIKey)
//     message := mg.NewMessage(s.From, subject, body, to)
//     _, _, err := mg.Send(context.Background(), message)
//     return err
// }
